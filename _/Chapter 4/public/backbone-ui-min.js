(function(a){"undefined"===typeof Backbone&&alert("backbone environment not loaded");"undefined"===typeof $&&alert("jquery environment not loaded");Backbone.UI=Backbone.UI||{KEYS:{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45},setSkin:function(a){Backbone.UI.currentSkin&&$(document.body).removeClass("skin_"+Backbone.UI.currentSkin);$(document.body).addClass("skin_"+
a);Backbone.UI.currentSkin=a},noop:function(){},IS_MOBILE:void 0!==document.ontouchstart||null===document.ontouchstart,setMobile:function(a){Backbone.UI.IS_MOBILE=a}};_(Backbone.View.prototype).extend({resolveContent:function(a,c,d){d=null===d||_(d).isUndefined()?this.options.content:d;a=_(a).exists()?a:this.model;c=_(c).exists()?c:d;d=_(a).exists()&&_(c).exists();return _(c).isFunction()?c(a):d&&_(a[c]).isFunction()?a[c]():d&&_(_(a).resolveProperty(c)).isFunction()?_(a).resolveProperty(c)(a):d?_(a).resolveProperty(c):
c},mixin:function(a){var c=_(this.options).clone();_(a).each(function(a){$.extend(!0,this,a)},this);$.extend(!0,this.options,c)}});_.mixin({nameForIndex:function(a,c){return 1===a.length?"first last":0===c?"first":c===a.length-1?"last":"middle"},exists:function(a){return!_(a).isNull()&&!_(a).isUndefined()},resolveProperty:function(a,c){var d=null;if(_(c).exists()&&_(c).isString()){var f=c.split(".");_(f).each(function(c){if(_(a).exists()){var f=d||a;d=_(f.get).isFunction()?f.get(c):f[c]}})}return d},
setProperty:function(a,c,d,f){if(c){var k=c.split(".");_(k.slice(0,k.length-2)).each(function(c){!_(a).isNull()&&!_(a).isUndefined()&&(a=_(a.get).isFunction()?a.get(c):a[c])});a&&(_(a.set).isFunction()?(k={},k[c]=d,a.set(k,{silent:f})):a[c]=d)}}});_($.fn).extend({alignTo:function(a,c,d,f,k){_.each(this,function(g){var e,l,s=!1;"none"===g.style.display&&(s=!0,$(g).css({position:"absolute",top:"-10000px",left:"-10000px",display:"block"}));var n,h=a;e=c;n=$(g);h=$(h);e=e||"";l=h.offset();var m=h.width(),
h=h.height();n.offset();var p=n.width();n=n.height();m=0<=e.indexOf("-left")?l.left:0<=e.indexOf("left")?l.left-p:0<=e.indexOf("-right")?l.left+m-p:0<=e.indexOf("right")?l.left+m:l.left+(m-p)/2;l=0<=e.indexOf("-top")?l.top:0<=e.indexOf("top")?l.top-n:0<=e.indexOf("-bottom")?l.top+h-n:0<=e.indexOf("bottom")?l.top+h:l.top+(h-n)/2;e.indexOf("no-constraint");m+=d||0;l+=f||0;e=m;_(k).isElement()&&(m=$(k).offset(),e-=m.left,l-=m.top);$(g).css({position:"absolute",left:Math.round(e)+"px",top:Math.round(l)+
"px"});s&&$(g).hide()})},autohide:function(a){_.each(this,function(c){a=_.extend({onEvent:"click",leaveOpen:!1,hideCallback:!1,ignoreInputs:!1,ignoreKeys:[],leaveOpenTargets:[]},a||{});c._autoignore=!0;setTimeout(function(){c._autoignore=!1;$(c).removeAttr("_autoignore")},0);c._autohider||(c._autohider=_.bind(function(d){var f=d.target;if($(c).is(":visible")&&(!a.ignoreInputs||!/input|textarea|select|option/i.test(f.nodeName)))if(!c._autoignore&&(!d.type||!d.type.match(/keypress/)||!_.include(a.ignoreKeys,
d.keyCode))&&(!a.leaveOpenTargets||!_(a.leaveOpenTargets).find(function(a){return d.target===a||0<$(d.target).closest($(a)).length})))if(a.hideCallback?a.hideCallback(c):1)$(c).hide(),$(document).bind(a.onEvent,c._autohider),$(document).bind("keypress",c._autohider),c._autohider=null},this),$(document).bind(a.onEvent,c._autohider),$(document).bind("keypress",c._autohider))})}})})(this);
(function(){window.Backbone.UI.Button=Backbone.View.extend({options:{tagName:"button",disabled:!1,active:!1,onClick:null,isSubmit:!1},initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasGlyph]);_(this).bindAll("render");$(this.el).addClass("button");$(this.el).bind("click",_(function(a){if(!this.options.disabled&&!this.options.active&&this.options.onClick)this.options.onClick(a);return!1}).bind(this))},render:function(){var a=this.resolveContent();this._observeModel(this.render);
$(this.el).empty();this.options.isSubmit&&$(this.el).attr({type:"submit",value:""});var a=$.el.span(a),b=this.resolveGlyph(this.model,this.options.glyphLeftClassName),c=this.resolveGlyph(this.model,this.options.glyphRightClassName);this.insertGlyphLayout(b,c,a,this.el);this.setEnabled(!this.options.disabled);this.setActive(this.options.active);return this},setEnabled:function(a){this.options.disabled=!a;$(this.el).toggleClass("disabled",!a);$(this.el).attr({disabled:!a})},setActive:function(a){this.options.active=
a;$(this.el).toggleClass("active",a)}})})();
(function(){var a="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),b="smtwtfs".split(""),c=function(a){var c=a.getYear();return[31,0===c%4&&0!==c%100||0===c%400?29:28,31,30,31,30,31,31,30,31,30,31][a.getMonth()]};window.Backbone.UI.Calendar=Backbone.View.extend({options:{date:null,weekStart:0,onSelect:null,minDate:null,maxDate:null},date:null,initialize:function(){$(this.el).addClass("calendar");_(this).bindAll("render")},render:function(){if(_(this.model).exists()&&_(this.options.content).exists()){this.date=
this.resolveContent();_(this.date).isDate()||(this.date=new Date);var a="change:"+this.options.content;this.model.unbind(a,this.render);this.model.bind(a,this.render)}else this.date=this.date||this.options.date||new Date;_(this.model).exists()&&_(this.options.minDate).exists()?(this.minDate=this.resolveContent(this.model,this.options.minDate),_(this.minDate).isDate()||(this.minDate=new Date),a="change:"+this.options.minDate,this.model.unbind(a,this.render),this.model.bind(a,this.render)):this.minDate=
null;_(this.model).exists()&&_(this.options.maxDate).exists()?(this.maxDate=this.resolveContent(this.model,this.options.maxDate),_(this.maxDate).isDate()||(this.maxDate=new Date),a="change:"+this.options.maxDate,this.model.unbind(a,this.render),this.model.bind(a,this.render)):this.maxDate=null;this._renderDate(this.date,this.minDate,this.maxDate);return this},_selectDate:function(a){this.date=a;if(_(this.model).exists()&&_(this.options.content).exists()){var c=this.resolveContent(),c=_(c).isDate()?
new Date(c.getTime()):new Date;c.setMonth(a.getMonth());c.setDate(a.getDate());c.setFullYear(a.getFullYear());_(this.model).setProperty(this.options.content,c)}this.render();if(_(this.options.onSelect).isFunction())this.options.onSelect(a);return!1},_renderDate:function(d,f,k,g){g&&g.stopPropagation();$(this.el).empty();g=f?moment(f).startOf("day").toDate():null;for(var e=k?moment(k).endOf("day").toDate():null,l=moment(d).startOf("day").toDate(),s=moment(d).endOf("day").toDate(),n=new Date(d.getFullYear(),
d.getMonth()+1),h=new Date(d.getFullYear(),d.getMonth()-1),m=(new Date(d.getFullYear(),d.getMonth(),1)).getDay()-this.options.weekStart-1,p=c(d),t=new Date,C=t.getFullYear()===d.getFullYear()&&t.getMonth()===d.getMonth(),D=!!this.date&&this.date.getFullYear()===d.getFullYear()&&this.date.getMonth()===d.getMonth(),z=$.el.tr({className:"row days"}),w=b.slice(this.options.weekStart).concat(b.slice(0,this.options.weekStart)),r=0;r<w.length;r++)$.el.td(w[r]).appendTo(z);z=$.el.table($.el.thead($.el.th($.el.a({className:"go_back",
onclick:_(this._renderDate).bind(this,h,f,k)},"\u2039")),$.el.th({className:"title",colspan:5},$.el.div(a[d.getMonth()]+" "+d.getFullYear())),$.el.th($.el.a({className:"go_forward",onclick:_(this._renderDate).bind(this,n,f,k)},"\u203a"))),n=$.el.tbody(z));h=0<=m?c(h)-m:1;for(r=w=0;6>r;r++){for(var B=$.el.tr({className:"row"+(0===r?" first":4===r?" last":"")}),x=0;7>x;x++){var A=w<=m||w>m+p,q;if(q=_(f).isDate()){q=g;var u=l,y=h,v=new Date(u);v.setFullYear(u.getFullYear());v.setMonth(u.getMonth());
v.setDate(y);q=v.getTime()<q.getTime()}if(!q&&(q=_(k).isDate()))q=e,u=s,y=h,v=new Date(u),v.setFullYear(u.getFullYear()),v.setMonth(u.getMonth()),v.setDate(y),q=v.getTime()>q.getTime();u=_(this._selectDate).bind(this,new Date(d.getFullYear(),d.getMonth(),h));y="cell"+(A?" inactive":"")+(q?" out_of_range":"")+(0===x?" first":6===x?" last":"")+(C&&!A&&h===t.getDate()?" today":"")+(D&&!A&&h===this.date.getDate()?" selected":"");$.el.td({className:y},A||q?$.el.div({className:"day"},h):$.el.a({className:"day",
onClick:u},h)).appendTo(B);h=0===r&&x===m||0<r&&h===p?1:h+1;w++}B.appendTo(n)}this.el.appendChild(z);return!1}})})();
(function(){window.Backbone.UI.Checkbox=Backbone.View.extend({options:{labelContent:null,disabled:!1},initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasGlyph,Backbone.UI.HasError]);_(this).bindAll("_refreshCheck");$(this.el).addClass("checkbox");this.options.name&&$(this.el).addClass(this.options.name);this.label=$.el.label();this.input=$.el.input({type:"checkbox"});$(this.input).change(_(this._updateModel).bind(this));$(this.input).click(_(this._updateModel).bind(this));this._observeModel(_(this._refreshCheck).bind(this))},
render:function(){$(this.el).empty();$(this.label).empty();$(this.input).off("change");$(this.input).off("click");var a=null!==this.resolveContent()?this.resolveContent():this.input.checked;$(this.input).attr({name:this.options.name,id:this.options.name,tabIndex:this.options.tabIndex,checked:a,disabled:this.options.disabled});a=this.resolveContent(this.model,this.options.labelContent)||this.options.labelContent;this.label.appendChild(this.input);this._labelText=$.el.span(a);var a=$.el.div({className:"checkbox_wrapper"}),
b=this._labelText,c=this.resolveGlyph(this.model,this.options.glyphLeftClassName),d=this.resolveGlyph(this.model,this.options.glyphRightClassName);this.insertGlyphLayout(c,d,b,a);this.label.appendChild(a);this.el.appendChild(this.label);this.setEnabled(!this.options.disabled);$(this.input).on("change",_(this._updateModel).bind(this));$(this.input).on("click",_(this._updateModel).bind(this));return this},_refreshCheck:function(){var a=this.resolveContent();$(this.input).attr({checked:a});a=this.resolveContent(this.model,
this.options.labelContent)||this.options.labelContent;$(this._labelText).text(a)},_updateModel:function(){_(this.model).setProperty(this.options.content,this.input.checked)},setEnabled:function(a){a?$(this.el).removeClass("disabled"):$(this.el).addClass("disabled");this.input.disabled=!a}})})();
(function(){window.Backbone.UI.CollectionView=Backbone.View.extend({options:{model:null,itemView:null,itemViewOptions:null,emptyContent:null,onItemClick:Backbone.UI.noop,maxHeight:null,renderOnChange:!0},itemViews:{},_emptyContent:null,_renderItem:Backbone.UI.noop,initialize:function(){this.model&&(this.model.bind("add",_.bind(this._onItemAdded,this)),this.options.renderOnChange&&this.model.bind("change",_.bind(this._onItemChanged,this)),this.model.bind("remove",_.bind(this._onItemRemoved,this)),
this.model.bind("refresh",_.bind(this.render,this)),this.model.bind("reset",_.bind(this.render,this)))},_onItemAdded:function(a,b,c){this.collectionEl&&!this.itemViews[a.cid]&&(this._emptyContent&&(this._emptyContent.parentNode&&this._emptyContent.parentNode.removeChild(this._emptyContent),this._emptyContent=null),b=b.indexOf(a),a=this._renderItem(a,b),b=this.collectionEl.childNodes[b],this.collectionEl.insertBefore(a,_(b).isUndefined()?null:b),this._updateClassNames())},_onItemChanged:function(a){this.collectionEl&&
((a=this.itemViews[a.cid])&&a.el&&a.el.parentNode?(this._ensureProperPosition(a),a.render()):this.render())},_onItemRemoved:function(a){if(this.collectionEl){var b=this.itemViews[a.cid],c=b.el.parentNode;b&&(c&&c.parentNode)&&c.parentNode.removeChild(c);delete this.itemViews[a.cid];this._updateClassNames()}},_updateClassNames:function(){var a=this.collectionEl.childNodes;0<a.length&&(_(a).each(function(a,c){$(a).removeClass("first");$(a).removeClass("last");$(a).addClass(0===c%2?"even":"odd")}),$(a[0]).addClass("first"),
$(a[a.length-1]).addClass("last"))},_ensureProperPosition:function(a){if(_(this.model.comparator).isFunction()){this.model.sort({silent:!0});var b=a.el.parentNode,c=_(this.collectionEl.childNodes).indexOf(b,!0);a=this.model.indexOf(a.model);c!==a&&(b.parentNode.removeChild(b),(c=this.collectionEl.childNodes[a])?this.collectionEl.insertBefore(b,c):this.collectionEl.appendChild(b))}}})})();
(function(){window.Backbone.UI.DatePicker=Backbone.View.extend({options:{format:"MM/DD/YYYY",date:null,name:null,onChange:null,minDate:null,maxDate:null},initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasFormLabel,Backbone.UI.HasError]);$(this.el).addClass("date_picker");this._calendar=new Backbone.UI.Calendar({className:"date_picker_calendar",model:this.model,content:this.options.content,onSelect:_(this._selectDate).bind(this),minDate:this.options.minDate,maxDate:this.options.maxDate});
$(this._calendar.el).hide();document.body.appendChild(this._calendar.el);$(this._calendar.el).autohide({ignoreInputs:!0,leaveOpenTargets:[this._calendar.el]});this._observeModel(_(this.render).bind(this))},render:function(){$(this.el).empty();this._textField=(new Backbone.UI.TextField({name:this.options.name,placeholder:this.options.placeholder,glyphLeftClassName:this.options.glyphLeftClassName,glyphRightClassName:this.options.glyphRightClassName})).render();$(this._textField.input).click(_(this._showCalendar).bind(this));
$(this._textField.input).blur(_(this._dateEdited).bind(this));$(this._textField.input).keyup(_(this._hideCalendar).bind(this));this.el.appendChild(this.wrapWithFormLabel(this._textField.el));if(this._selectedDate=this.model&&this.options.content?this.resolveContent():this.options.date){this._calendar.options.date=this._selectedDate;var a=moment(this._selectedDate).format(this.options.format);this._textField.setValue(a)}this._calendar.render();return this},setEnabled:function(a){this._textField.setEnabled(a)},
getValue:function(){return this._selectedDate},setValue:function(a){this._selectedDate=a;a=moment(a).format(this.options.format);this._textField.setValue(a);this._dateEdited()},_showCalendar:function(){$(this._calendar.el).show();$(this._calendar.el).alignTo(this._textField.el,"bottom -left",0,2)},_hideCalendar:function(a){a&&a.keyCode===Backbone.UI.KEYS.KEY_RETURN&&this._dateEdited();$(this._calendar.el).hide()},_selectDate:function(a){a.getMonth();a.getDate();a=moment(a).format(this.options.format);
this._textField.setValue(a);this._dateEdited();this._hideCalendar();return!1},_dateEdited:function(a){var b=moment(this._textField.getValue(),this.options.format);this._selectedDate=b?b.toDate():null;if(!a||!("blur"===a.type&&$(this._calendar.el).is(":visible")))if(!a||a.keyCode===Backbone.UI.KEYS.KEY_RETURN||"blur"===a.type){a=moment(b).format(this.options.format);this._textField.setValue(a);this._hideCalendar();if(this.model&&this.options.content){var c=this.resolveContent()||new Date,c=new Date(c.getTime());
c.setMonth(b.month());c.setDate(b.date());c.setFullYear(b.year());_(this.model).setProperty(this.options.content,c)}else this._calendar.date=this._selectedDate,this._calendar.render();if(_(this.options.onChange).isFunction())this.options.onChange(a)}}})})();
(function(){Backbone.UI.DragSession=function(a){this.options=_.extend({dragEvent:null,scope:null,onClick:Backbone.UI.noop,onStart:Backbone.UI.noop,onMove:Backbone.UI.noop,onStop:Backbone.UI.noop,onAbort:Backbone.UI.noop,onDone:Backbone.UI.noop},a);Backbone.UI.DragSession.currentSession&&Backbone.UI.DragSession.currentSession.abort();this._doc=this.options.scope||document;this._handleEvent=_.bind(this._handleEvent,this);this._handleEvent(this.options.dragEvent);this._activate(!0);this.options.dragEvent.stopPropagation();
Backbone.UI.DragSession.currentSession=this};_.extend(Backbone.UI.DragSession,{SLOP:2,BASIC_DRAG_CLASSNAME:"dragging",enableBasicDragSupport:function(a,b,c){a=a?a.document||a:document;a._basicDragSupportEnabled||(a._basicDragSupportEnabled=!0,$(a).bind("mousedown",function(a){var c=a.target;if(!/(input|textarea|button|select|option)/i.exec(c.nodeName)&&c.hasClassName){var b=c.hasClassName("draggable")?c:c.up(".draggable");if(b=b?b.up(".draggable-container")||b:null){var g=b.getBounds(),e=document.activeElement;
new Backbone.UI.DragSession({dragEvent:a,scope:b.ownerDocument,onStart:function(a){e&&e.blur&&e.blur();a.pos=b.positionedOffset();$(b).addClass(Backbone.UI.DragSession.BASIC_DRAG_CLASSNAME)},onMove:function(a){b.style.left=g.x+"px";b.style.top=g.y+"px"},onDone:function(a){e&&e.focus&&e.focus();b.removeClassName(Backbone.UI.DragSession.BASIC_DRAG_CLASSNAME)}})}}}))}});_.extend(Backbone.UI.DragSession.prototype,{stop:function(){this._stop()},abort:function(){this._stop(!0)},_activate:function(a){a=
a?"bind":"unbind";$(this._doc)[a]("mousemove",this._handleEvent);$(this._doc)[a]("mouseup",this._handleEvent);$(this._doc)[a]("keyup",this._handleEvent)},_handleEvent:function(a){a.stopPropagation();a.preventDefault();this.x=a.pageX;this.y=a.pageY;"mousedown"===a.type&&(this.xStart=this.x,this.yStart=this.y);this.dx=this.x-this.xStart;this.dy=this.y-this.yStart;switch(a.type){case "mousemove":if(this._dragging)this.options.onMove(this,a);else this.dx*this.dx+this.dy*this.dy>=Backbone.UI.DragSession.SLOP*
Backbone.UI.DragSession.SLOP&&(this._dragging=!0,this.options.onStart(this,a));break;case "mouseup":if(this._dragging)this.stop();else this.options.onClick(this,a);break;case "keyup":if(a.keyCode!==Backbone.UI.KEYS.KEY_ESC)break;this.abort()}},_stop:function(a){Backbone.UI.DragSession.currentSession=null;this._activate(!1);if(this._dragging){if(a)this.options.onAbort(this);else this.options.onStop(this);this.options.onDone(this)}}})})();
(function(){Backbone.UI.HasAlternativeProperty={options:{alternatives:null,altLabelContent:null,altValueContent:null,formLabelContent:null,altGlyphLeftClassName:null,altGlyphRightClassName:null},_determineSelectedItem:function(){var a;if(_(this.model).exists()&&_(this.options.content).exists()&&(a=_(this.model).resolveProperty(this.options.content),_(this.options.altValueContent).exists())){var b=_(this._collectionArray()).detect(function(c){return(c.attributes||c)[this.options.altValueContent]===
a},this);_(b).isUndefined()||(a=b)}return a||this.options.selectedItem},_setSelectedItem:function(a,b){this.selectedItem=this.selectedValue=a;_(this.model).exists()&&_(this.options.content).exists()&&(this.selectedValue=this._valueForItem(a),_(this.model).setProperty(this.options.content,this.selectedValue,b))},_valueForItem:function(a){return _(this.options.altValueContent).exists()?_(a).resolveProperty(this.options.altValueContent):a},_collectionArray:function(){return _(this.options.alternatives).exists()?
this.options.alternatives.models||this.options.alternatives:[]},_observeCollection:function(a){_(this.options.alternatives).exists()&&_(this.options.alternatives.bind).exists()&&(this.options.alternatives.unbind("change",a),this.options.alternatives.bind("change",a))}}})();
(function(){Backbone.UI.HasError={options:{errorType:"inform",errorPosition:"below"},unsetError:function(){$(this.el).removeClass("error");$(this.errorMessage).remove();$(this._disclosure).remove();_(this._unobserveModel).exists()&&this._unobserveModel(_(this.unsetError).bind(this))},setError:function(a){_(this._observeModel).exists()&&this._observeModel(_(this.unsetError).bind(this));a=null===a||_(a).isUndefined()?"":a;this.unsetError();$(this.el).addClass("error");0<a.length&&("disclosure"!==this.options.errorType?
this.errorMessage=$.el.span({className:"error_message "+this.options.errorPosition},a):(this.errorMessage=$.el.span({className:"error_message right with_disclosure"},"!"),this._disclosure=$.el.div({className:"disclosure"},this._disclosureOuter=$.el.div({className:"disclosure_outer"},this._disclosureInner=$.el.div({className:"disclosure_inner"},a),this._disclosureArrow=$.el.div({className:"disclosure_arrow"}))),$(this.errorMessage).click(_(function(a){a.preventDefault();this._showDisclosure();return!1}).bind(this)),
$(this.el).click(_(function(){$(this._disclosure).remove()}).bind(this))),this.el.childNodes[0].appendChild(this.errorMessage),this._disclosure&&this._showDisclosure())},_showDisclosure:function(){this.el.appendChild(this._disclosure);"right"===this.options.errorPosition?$(this._disclosure).alignTo(this.errorMessage,"right",10,0,this.el):$(this._disclosure).alignTo(this.errorMessage,"center bottom",0,10,this.el);$(this._disclosureOuter).addClass("right"===this.options.errorPosition?"arrow_left":"arrow_up");
var a="right"===this.options.errorPosition?$(this._disclosure).height()/2-10:$(this._disclosure).width()/2-10,b="right"===this.options.errorPosition?"top":"left";$(this._disclosureArrow).css(b,a+"px")}}})();(function(){Backbone.UI.HasFocus={setupFocus:function(a,b){$(a).focusin(_(function(a){$(b).addClass("focused")}).bind(this));$(a).focusout(_(function(a){$(b).removeClass("focused")}).bind(this))}}})();
(function(){Backbone.UI.HasFormLabel={wrapWithFormLabel:function(a){var b=$.el.label(),c=this.options.formLabelContent?this.resolveContent(this.model,this.options.formLabelContent,this.options.formLabelContent)||this.options.formLabelContent:null;c&&b.appendChild($.el.span({className:"form_label"},c));b.appendChild(a);return b}}})();
(function(){Backbone.UI.HasGlyph={insertGlyphLayout:function(a,b,c,d){a&&(a=$.el.span({className:"glyph left "+a}),d.appendChild(a));c&&d.appendChild(c);b&&(b=$.el.span({className:"glyph right "+b}),d.appendChild(b))},resolveGlyph:function(a,b){if(null===b)return null;var c=null;if(_(a).exists()&&_((a.attributes||a)[b]).exists())c=this.resolveContent(a,b);return _(c).exists()?c:b}}})();
(function(){Backbone.UI.HasModel={options:{model:null,content:null,formLabelContent:null,glyphLeftClassName:null,glyphRightClassName:null},_observeModel:function(a){_(this.model).exists()&&_(this.model.unbind).isFunction()&&_(["content","labelContent"]).each(function(b){b=this.options[b];_(b).exists()&&(b="change:"+b,this.model.unbind(b,a),this.model.bind(b,a))},this)},_unobserveModel:function(a){_(this.model).exists()&&_(this.model.unbind).isFunction()&&_(["content","labelContent"]).each(function(b){b=
this.options[b];_(b).exists()&&this.model.unbind("change:"+b,a)},this)}}})();
window.jQuery&&function(a,b){function c(c){return"true"==a(c).prop("contenteditable")||c.tagName in g}var d="value.inputEvent",f="input textInput propertychange paste cut keydown keyup drop ".split(" ").join(".inputEvent "),k=["focusin","mouseover","dragstart",""].join(".inputEvent "),g={TEXTAREA:b,INPUT:b},e={paste:b,cut:b,keydown:b,drop:b,textInput:b};a.event.special.txtinput={setup:function(b,g,n){function n(c){var b=c.target;window.clearTimeout(h);h=null;t||(c.type in e&&!h?h=window.setTimeout(function(){b.value!==
a.data(b,d)&&(a(b).trigger("txtinput"),a.data(b,d,b.value))},0):"propertychange"==c.type?"value"==c.originalEvent.propertyName&&(a(b).trigger("txtinput"),a.data(b,d,b.value),t=!0,window.setTimeout(function(){t=!1},0)):(a(b).trigger("txtinput"),a.data(b,d,b.value),t=!0,window.setTimeout(function(){t=!1},0)))}var h,m,p=this;b=a(this);var t=!1;c(p)?((m=a.data(p,"bound.inputEvent")||0)||b.bind(f,n),a.data(p,"bound.inputEvent",++m),a.data(p,d,p.value)):b.bind(k,function(b){b=b.target;c(b)&&!a.data(p,"delegated.inputEvent")&&
((m=a.data(b,"bound.inputEvent")||0)||a(b).bind(f,n),a.data(p,"delegated.inputEvent",!0),a.data(b,"bound.inputEvent",++m),a.data(b,d,b.value))})},teardown:function(){var b=a(this);b.unbind(k);b.find("input, textarea").andSelf().each(function(){(bndCount=a.data(this,"bound.inputEvent",(a.data(this,"bound.inputEvent")||1)-1))||b.unbind(f)})}};a.fn.input=function(b){return b?a(this).bind("txtinput",b):this.trigger("txtinput")}}(window.jQuery);
(function(){window.Backbone.UI.Label=Backbone.View.extend({options:{emptyContent:"",tagName:"label"},initialize:function(){this.mixin([Backbone.UI.HasModel]);_(this).bindAll("render");this.options.name&&$(this.el).addClass(this.options.name)},render:function(){var a=this.resolveContent(this.model,this.options.labelContent)||this.options.labelContent;void 0===a&&(a=this.options.emptyContent);this._observeModel(this.render);$(this.el).empty();this.el.appendChild(document.createTextNode(a));return this}})})();
(function(){window.Backbone.UI.Link=Backbone.View.extend({options:{tagName:"a",disabled:!1,onClick:null},initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasGlyph]);_(this).bindAll("render");$(this.el).addClass("link");$(this.el).bind("click",_(function(a){if(!this.options.disabled&&this.options.onClick)this.options.onClick(a);return!1}).bind(this))},render:function(){var a=this.resolveContent();this._observeModel(this.render);$(this.el).empty();var a=$.el.span(a),b=this.resolveGlyph(this.model,
this.options.glyphLeftClassName),c=this.resolveGlyph(this.model,this.options.glyphRightClassName);this.insertGlyphLayout(b,c,a,this.el);this.setEnabled(!this.options.disabled);return this},setEnabled:function(a){a?this.el.href="#":this.el.removeAttribute("href");this.options.disabled=!a;$(this.el).toggleClass("disabled",!a)}})})();
(function(){window.Backbone.UI.List=Backbone.UI.CollectionView.extend({initialize:function(){Backbone.UI.CollectionView.prototype.initialize.call(this,arguments);$(this.el).addClass("list")},render:function(){$(this.el).empty();this.itemViews={};this.collectionEl=$.el.ul();(!_(this.model).exists()||0===this.model.length)&&this.options.emptyContent?(this._emptyContent=_(this.options.emptyContent).isFunction()?this.options.emptyContent():this.options.emptyContent,(this._emptyContent=$.el.li(this._emptyContent))&&
this.collectionEl.appendChild(this._emptyContent)):_(this.model.models).each(function(a,b){var c=this._renderItem(a,b);this.collectionEl.appendChild(c)},this);this.el.appendChild(this.collectionEl);this._updateClassNames();return this},_renderItem:function(a,b){var c;_(this.options.itemView).exists()&&(_(this.options.itemView).isString()?c=this.resolveContent(a,this.options.itemView):(c=new this.options.itemView(_({model:a}).extend(this.options.itemViewOptions)),c.render(),this.itemViews[a.cid]=c,
c=c.el));c=$.el.li(c);this.options.onItemClick&&$(c).click(_(this.options.onItemClick).bind(this,a));return c}})})();
(function(){window.Backbone.UI.Menu=Backbone.View.extend({options:{emptyItem:null,disabled:!1,onChange:Backbone.UI.noop,placeholder:"Select...",size:1},initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasAlternativeProperty,Backbone.UI.HasFormLabel,Backbone.UI.HasError]);_(this).bindAll("render");$(this.el).addClass("menu")},render:function(){$(this.el).empty();this._observeModel(this.render);this._observeCollection(this.render);this.selectedItem=this._determineSelectedItem();var a=
this._valueForItem(this.selectedItem);this.select=$.el.select({size:this.options.size,disabled:this.options.disabled});$(this.select).change(_(this._updateModel).bind(this));var b=0;this._placeholder=null;!this.options.emptyItem&&(1===this.options.size&&!a)&&(this._placeholder=$.el.option(this.options.placeholder),$(this._placeholder).data("value",null),$(this._placeholder).attr({disabled:"true"}),this.select.appendChild(this._placeholder),b++);this.options.emptyItem&&(this._emptyItem=$.el.option(this._labelForItem(this.options.emptyItem)),
$(this._emptyItem).data("value",null),this.select.appendChild(this._emptyItem),$(this._emptyItem).click(_(function(){this.select.selectedIndex=0;this._updateModel()}).bind(this)),b++);this._selectedIndex=-1+b;_(this._collectionArray()).each(function(c,d){d+=b;var f=this._valueForItem(c);_(a).isEqual(f)&&(this._selectedIndex=d);var k=$.el.option(this._labelForItem(c));$(k).data("value",f);$(k).attr({selected:this._selectedIndex===d});$(k).click(_(function(a){this.select.selectedIndex=a;this._updateModel()}).bind(this,
d));this.select.appendChild(k)},this);this.select.selectedIndex=this._selectedIndex;this.el.appendChild(this.wrapWithFormLabel(this.select));this.scrollToSelectedItem();this.setEnabled(!this.options.disabled);return this},setEnabled:function(a){$(this.el).toggleClass("disabled",!a);this.select.disabled=!a},_labelForItem:function(a){return!_(a).exists()?this.options.placeholder:this.resolveContent(a,this.options.altLabelContent)},setSelectedItem:function(a){this._setSelectedItem(a);$(this._placeholder).remove()},
_updateModel:function(){var a=this._itemForValue($(this.select.options[this.select.selectedIndex]).data("value")),b=this.selectedItem!==a;this._setSelectedItem(a);if(_(this.options.onChange).isFunction()&&b)this.options.onChange(a)},_itemForValue:function(a){return null===a?a:_(this._collectionArray()).find(function(b){var c=a===b;b=this.resolveContent(b,this.options.altValueContent)===a;return c||b},this)},scrollToSelectedItem:function(){if(0<this.select.selectedIndex){var a=$(this.select).find("option").eq(0).height(),
a=0<a?a:12;$(this.select).scrollTop(this.select.selectedIndex*a)}}})})();
(function(){window.Backbone.UI.Pulldown=Backbone.View.extend({options:{placeholder:"Select...",disabled:!1,onChange:Backbone.UI.noop},initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasAlternativeProperty,Backbone.UI.HasGlyph,Backbone.UI.HasFormLabel,Backbone.UI.HasError,Backbone.UI.HasFocus]);_(this).bindAll("render");$(this.el).addClass("pulldown");this.options.name&&$(this.el).addClass(this.options.name)},render:function(){$(this.el).empty();this._menu=(new Backbone.UI.Menu({model:this.model,
content:this.options.content,alternatives:this.options.alternatives,altLabelContent:this.options.altLabelContent,altValueContent:this.options.altValueContent,onChange:this.options.onChange,placeholder:this.options.placeholder,emptyItem:this.options.emptyItem,size:1,disabled:this.options.disabled})).render();this._parent=$.el.div({className:"pulldown_wrapper"});var a=this.resolveGlyph(this.model,this.options.glyphLeftClassName),b=this.resolveGlyph(this.model,this.options.glyphRightClassName);this.insertGlyphLayout(a,
b,this._menu.el,this._parent);this.setupFocus(this._menu.el,this._parent);this.el.appendChild(this.wrapWithFormLabel(this._parent));return this},setEnabled:function(a){this.options.disabled=!a;this._menu.setEnabled(a)}})})();
(function(){window.Backbone.UI.RadioGroup=Backbone.View.extend({options:{content:"group",disabled:!1,onChange:Backbone.UI.noop},initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasAlternativeProperty,Backbone.UI.HasGlyph,Backbone.UI.HasFormLabel,Backbone.UI.HasError]);_(this).bindAll("render");$(this.el).addClass("radio_group");this.options.name&&$(this.el).addClass(this.options.name)},selectedItem:null,render:function(){$(this.el).empty();this._observeModel(this.render);this._observeCollection(this.render);
this.selectedItem=this._determineSelectedItem()||this.selectedItem;var a=this._valueForItem(this.selectedItem);this.group=$.el.div({className:"radio_group_wrapper"});_(this._collectionArray()).each(function(b,c){var d=this._valueForItem(b),f=a===d,k=this.resolveContent(b,this.options.altLabelContent),g=$.el.input();$(g).attr({type:"radio",name:this.options.content,value:d,checked:f});$(g).change(_(this._updateModel).bind(this,b));$(g).click(_(this._updateModel).bind(this,b));var d=$.el.div({className:"radio_group_wrapper"}),
k=$.el.span(k),f=(f=this.resolveGlyph(b,this.options.altGlyphLeftClassName))&&f!==this.options.altGlyphLeftClassName?f:this.resolveGlyph(null,this.options.glyphLeftClassName),e=this.resolveGlyph(b,this.options.altGlyphRightClassName),e=e&&e!==this.options.altGlyphRightClassName?e:this.resolveGlyph(null,this.options.glyphRightClassName);this.insertGlyphLayout(f,e,k,d);this.group.appendChild($.el.label({className:_(this._collectionArray()).nameForIndex(c++)+" "+(0===c%2?"even":"odd")},g,d))},this);
this.el.appendChild(this.wrapWithFormLabel(this.group));this.setEnabled(!this.options.disabled);return this},_updateModel:function(a){var b=this.selectedItem!==a;this._setSelectedItem(a);if(_(this.options.onChange).isFunction()&&b)this.options.onChange(a)},setEnabled:function(a){a?$(this.el).removeClass("disabled"):$(this.el).addClass("disabled")}})})();
(function(){Backbone.UI.TabSet=Backbone.View.extend({options:{alternatives:[],selectedTab:0},initialize:function(){$(this.el).addClass("tab_set")},render:function(){$(this.el).empty();this._tabs=[];this._contents=[];this._callbacks=[];this._tabBar=$.el.div({className:"tab_bar"});this._contentContainer=$.el.div({className:"content_container"});this.el.appendChild(this._tabBar);this.el.appendChild(this._contentContainer);for(var a=0;a<this.options.alternatives.length;a++)this.addTab(this.options.alternatives[a]);
0<=this.options.selectedTab?this.activateTab(this.options.selectedTab):$(this.el).addClass("no_selection");return this},addTab:function(a){var b=$.el.a({href:"#",className:"tab"});a.className&&$(b).addClass(a.className);var c=this.resolveContent(null,a.label);b.appendChild(_(c).isString()?document.createTextNode(c||""):c);this._tabBar.appendChild(b);this._tabs.push(b);c=a.content&&a.content.nodeType?a.content:$.el.div(a.content);this._contents.push(c);$(c).hide();this._contentContainer.appendChild(c);
var d=this._tabs.length-1;$(b).bind("click",_.bind(function(){this.activateTab(d);return!1},this));this._callbacks.push(a.onActivate||Backbone.UI.noop)},activateTab:function(a){var b=0>a;$(this.el).toggleClass("no_selection",b);_(this._contents).each(function(a){$(a).hide()});_(this._tabs).each(function(a){$(a).removeClass("selected")});_(this._selectedIndex).exists()&&$(this.el).removeClass("index_"+this._selectedIndex);b?this._selectedIndex=null:($(this.el).addClass("index_"+a),this._selectedIndex=
a,$(this._tabs[a]).addClass("selected"),$(this._contents[a]).show(),this._callbacks[a]())},getActiveTab:function(){return _(this._tabs).indexOf(_(this._tabs).find(function(a){return $(a).hasClass("selected")}))}})})();
(function(){window.Backbone.UI.TableView=Backbone.UI.CollectionView.extend({options:{columns:[],emptyContent:"no entries",onItemClick:Backbone.UI.noop,sortable:!1,onSort:null},initialize:function(){Backbone.UI.CollectionView.prototype.initialize.call(this,arguments);$(this.el).addClass("table_view");this._sortState={reverse:!0}},render:function(){$(this.el).empty();this.itemViews={};var a,b=$.el.div({className:"content"},a=$.el.table({cellPadding:"0",cellSpacing:"0"}));$(this.el).toggleClass("clickable",
this.options.onItemClick!==Backbone.UI.noop);var c=$.el.tr(),d=null;_(this.options.columns).each(_(function(a,b,g){var e=_(a.title).isFunction()?a.title():a.title,l=a.width?parseInt(a.width,10)+5:null,l=(l?"width:"+l+"px; max-width:"+l+"px; ":"")+(this.options.sortable?"cursor: pointer; ":"");a.comparator=_(a.comparator).isFunction()?a.comparator:function(b,c){return b.get(a.content)<c.get(a.content)?-1:b.get(a.content)>c.get(a.content)?1:0};var s=this._sortState.content===a.content||!1,n=s?this._sortState.reverse?
" asc":" desc":"",h=$.el.div({className:"glyph"}," asc"===n?"\u25b2 ":" desc"===n?"\u25bc ":""),m=this.options.sortable?_(this.options.onSort).isFunction()?_(function(b){this.options.onSort(a)}).bind(this):_(function(b,c){this._sort(a,c)}).bind(this):Backbone.UI.noop;b=$.el.th({className:_(g).nameForIndex(b)+(s?" sorted":""),style:l,onclick:m},$.el.div({className:"wrapper"+(s?" sorted":"")},e),s?$.el.div({className:"sort_wrapper"+n},h):null).appendTo(c);null===d&&(d=b)}).bind(this));this.el.appendChild($.el.table({className:"heading",
cellPadding:"0",cellSpacing:"0"},$.el.thead(c)));this.collectionEl=$.el.tbody();a.appendChild(this.collectionEl);!_(this.model).exists()||0===this.model.length?(this._emptyContent=_(this.options.emptyContent).isFunction()?this.options.emptyContent():this.options.emptyContent,(this._emptyContent=$.el.tr($.el.td(this._emptyContent)))&&this.collectionEl.appendChild(this._emptyContent)):_(this.model.models).each(function(a,b,c){a=this._renderItem(a,b);$(a).addClass(0===b%2?"even":"odd");0===b&&$(a).addClass("first");
b===c.length-1&&$(a).addClass("last");this.collectionEl.appendChild(a)},this);_(this.options.maxHeight).exists()?(a=$.el.div({style:"overflow:auto; max-height:"+this.options.maxHeight+"px"},b),this.el.appendChild(a.el)):this.el.appendChild(b);this._updateClassNames();return this},_renderItem:function(a,b){var c=$.el.tr();_(this.options.columns).each(function(b,f,k){var g=b.width?parseInt(b.width,10)+5:null,g=g?"width:"+g+"px; max-width:"+g+"px":null;b=this.resolveContent(a,b.content);c.appendChild($.el.td({className:_(k).nameForIndex(f),
style:g},$.el.div({className:"wrapper",style:g},b)))},this);this.options.onItemClick&&$(c).click(_(this.options.onItemClick).bind(this,a));return this.itemViews[a.cid]=c},_sort:function(a,b){this._sortState.reverse=!this._sortState.reverse;this._sortState.content=a.content;var c=a.comparator;this._sortState.reverse&&(c=function(b,c){return-a.comparator(b,c)});this.model.comparator=c;this.model.sort({silent:!!b})}})})();
(function(){window.Backbone.UI.TextArea=Backbone.View.extend({options:{className:"text_area",textAreaId:null,disabled:!1,tabIndex:null,onKeyPress:Backbone.UI.noop,maxLength:null},textArea:null,initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasFormLabel,Backbone.UI.HasError,Backbone.UI.HasFocus]);$(this.el).addClass("text_area");this.options.name&&$(this.el).addClass(this.options.name)},render:function(){var a=0<(this.textArea&&this.textArea.value.length)?this.textArea.value:this.resolveContent();
$(this.el).empty();this.textArea=$.el.textarea({id:this.options.textAreaId,tabIndex:this.options.tabIndex,placeholder:this.options.placeholder,maxLength:this.options.maxLength},a);this._observeModel(_(this._refreshValue).bind(this));this._parent=$.el.div({className:"textarea_wrapper"},this.textArea);this.el.appendChild(this.wrapWithFormLabel(this._parent));this.setupFocus(this.textArea,this._parent);this.setEnabled(!this.options.disabled);$(this.textArea).keyup(_(function(a){_.defer(_(this._updateModel).bind(this));
if(_(this.options.onKeyPress).exists()&&_(this.options.onKeyPress).isFunction())this.options.onKeyPress(a,this)}).bind(this));return this},getValue:function(){return this.textArea.value},setValue:function(a){$(this.textArea).empty();this.textArea.value=a;this._updateModel()},setEnabled:function(a){a?$(this.el).removeClass("disabled"):$(this.el).addClass("disabled");this.textArea.disabled=!a},_updateModel:function(){_(this.model).setProperty(this.options.content,this.textArea.value)},_refreshValue:function(){var a=
this.resolveContent();this.textArea&&this.textArea.value!==a&&(this.textArea.value=_(a).exists()?a:null)}})})();
(function(){window.Backbone.UI.TextField=Backbone.View.extend({options:{disabled:!1,type:"text",name:null,tabIndex:null,onKeyPress:Backbone.UI.noop,maxLength:null},input:null,initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasGlyph,Backbone.UI.HasFormLabel,Backbone.UI.HasError,Backbone.UI.HasFocus]);_(this).bindAll("_refreshValue");$(this.el).addClass("text_field");this.options.name&&$(this.el).addClass(this.options.name);this.input=$.el.input({maxLength:this.options.maxLength});
$(this.input).keyup(_(function(a){if(_(this.options.onKeyPress).exists()&&_(this.options.onKeyPress).isFunction())this.options.onKeyPress(a,this)}).bind(this));$(this.input).input(_(this._updateModel).bind(this));this._observeModel(this._refreshValue)},render:function(){var a=0<(this.input&&this.input.value.length)?this.input.value:this.resolveContent();$(this.el).empty();$(this.input).attr({type:this.options.type?this.options.type:"text",name:this.options.name,id:this.options.name,tabIndex:this.options.tabIndex,
placeholder:this.options.placeholder,pattern:this.options.pattern,value:a});this._parent=$.el.div({className:"text_wrapper"});var a=this.input,b=this.resolveGlyph(this.model,this.options.glyphLeftClassName),c=this.resolveGlyph(this.model,this.options.glyphRightClassName);this.insertGlyphLayout(b,c,a,this._parent);this.setupFocus(this.input,this._parent);this.el.appendChild(this.wrapWithFormLabel(this._parent));this.setEnabled(!this.options.disabled);return this},getValue:function(){return this.input.value},
setValue:function(a){this.input.value=a;this._updateModel()},setEnabled:function(a){a?$(this.el).removeClass("disabled"):$(this.el).addClass("disabled");this.input.disabled=!a},_updateModel:function(){_(this.model).setProperty(this.options.content,this.input.value)},_refreshValue:function(){var a=this.resolveContent();this.input&&this.input.value!==a&&(this.input.value=_(a).exists()?a:"")}})})();
(function(){window.Backbone.UI.TimePicker=Backbone.View.extend({options:{format:"hh:mm a",interval:30,name:null,disabled:!1},initialize:function(){this.mixin([Backbone.UI.HasModel,Backbone.UI.HasFormLabel,Backbone.UI.HasError]);$(this.el).addClass("time_picker");this._timeModel={};this._menu=new Backbone.UI.Menu({className:"time_picker_menu",model:this._timeModel,altLabelContent:"label",altValueContent:"label",content:"value",onChange:_(this._onSelectTimeItem).bind(this),size:10});$(this._menu.el).hide();
$(this._menu.el).autohide({ignoreInputs:!0});document.body.appendChild(this._menu.el);this._observeModel(_(this.render).bind(this))},render:function(){$(this.el).empty();this._textField=(new Backbone.UI.TextField({name:this.options.name,disabled:this.options.disabled,placeholder:this.options.placeholder,glyphLeftClassName:this.options.glyphLeftClassName,glyphRightClassName:this.options.glyphRightClassName})).render();$(this._textField.input).click(_(this._showMenu).bind(this));$(this._textField.input).blur(_(this._timeEdited).bind(this));
$(this._textField.input).keyup(_(this._hideMenu).bind(this));this.el.appendChild(this.wrapWithFormLabel(this._textField.el));var a=this.resolveContent();if(a){var b=moment(a).format(this.options.format);this._textField.setValue(b);this._timeModel.value=b;this._selectedTime=a}this._menu.options.alternatives=this._collectTimes();this._menu.options.model=this._timeModel;this._menu.render();return this},getValue:function(){return this._selectedTime},setValue:function(a){this._selectedTime=a;var b=moment(a).format(this.options.format);
this._textField.setValue(b);this._timeEdited();this._menu.options.selectedValue=a;this._menu.render()},setEnabled:function(a){this.options.disabled=!a;this._textField.setEnabled(a)},_collectTimes:function(){for(var a=[],b=moment().startOf("day"),c=b.date();b.date()===c;)a.push({label:b.format(this.options.format),value:new Date(b)}),b.add("minutes",this.options.interval);return a},_showMenu:function(){$(this._menu.el).is(":visible")||($(this._menu.el).alignTo(this._textField.el,"bottom -left",0,2),
$(this._menu.el).show(),this._menu.scrollToSelectedItem())},_hideMenu:function(a){a&&a.keyCode===Backbone.UI.KEYS.KEY_RETURN&&this._timeEdited();$(this._menu.el).hide()},_onSelectTimeItem:function(a){this._hideMenu();this._selectedTime=a.value;this._textField.setValue(moment(this._selectedTime).format(this.options.format));this._timeEdited()},_timeEdited:function(a){var b=this._textField.getValue();if(b&&(!a||!("blur"===a.type&&$(this._menu.el).is(":visible"))))if(b=moment(b,this.options.format),
!a||a.keyCode===Backbone.UI.KEYS.KEY_RETURN||"blur"===a.type){a=moment(b).format(this.options.format);this._textField.setValue(a);this._hideMenu();if(this.model&&this.options.content){var c=this.resolveContent(),c=new Date(c),c=isNaN(c.getTime())?new Date:c;c.setHours(b.hours());c.setMinutes(b.minutes());_(this.model).setProperty(this.options.content,c)}if(_(this.options.onChange).isFunction())this.options.onChange(a)}}})})();
